(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{330:function(t,e,a){"use strict";a.r(e);var n=a(33),s=Object(n.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"_0x1-使用内部修正版engine"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_0x1-使用内部修正版engine"}},[t._v("#")]),t._v(" 0x1: 使用内部修正版Engine")]),t._v(" "),a("h2",{attrs:{id:"flutter-engine-替换"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#flutter-engine-替换"}},[t._v("#")]),t._v(" Flutter Engine 替换")]),t._v(" "),a("p",[t._v("由于原生Flutter目前存在诸多问题，公司内部对源码进行了内部修正，目前替换成公司内部库。")]),t._v(" "),a("h2",{attrs:{id:"安装depot-tools"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装depot-tools"}},[t._v("#")]),t._v(" 安装depot_tools")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('git clone https://https://chromium.googlesource.com/chromium/tools/depot_tools.git\ncd depot_tools\npwd  //此处获得的path供稍后使用。简称$path1\nvi ~/.bash_profile\n//.bash_profile文件进入编辑模式后，下输入以下内容\n  #Depot_toolsBegin\n  export PATH="$PATH:$path1"\n  #DEpot_toolsEnd\n//esc后 wq!保存退出\nsource ~/.bash_profile\n')])])]),a("h2",{attrs:{id:"安装flutter-engine"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装flutter-engine"}},[t._v("#")]),t._v(" 安装Flutter Engine")]),t._v(" "),a("p",[t._v("使用公司内部engine")]),t._v(" "),a("h4",{attrs:{id:"check到内部指定commit"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#check到内部指定commit"}},[t._v("#")]),t._v(" check到内部指定commit")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("cd /src/flutter\ngit fetch upstream\ngit reset --hard af51afceb8886cc11e25047523c4e0c7e1f5d408 \n//支持ios 13 则\n// git reset --hard 6bdbe16\n")])])]),a("h4",{attrs:{id:"在flutter目录下创建-gclient"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在flutter目录下创建-gclient"}},[t._v("#")]),t._v(" 在flutter目录下创建.gclient")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('vi .gclient\n//进入编辑模式后，输入以下\n  solutions = [\n  {\n    "managed": False,\n    "name": "src/flutter",\n    "url": "https://xxxx/flutterplugin/flutterengine.git/", //内部git\n    "custom_deps": {},\n    "deps_file": "DEPS",\n    "safesync_url": "",\n  },\n]\n//esc, wq!\n.gclient sync\n')])])]),a("h2",{attrs:{id:"编译flutter-engin-工程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编译flutter-engin-工程"}},[t._v("#")]),t._v(" 编译Flutter Engin 工程")]),t._v(" "),a("h4",{attrs:{id:"ios-编译"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ios-编译"}},[t._v("#")]),t._v(" ios 编译")]),t._v(" "),a("ul",[a("li",[t._v("生成engine 工程")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("//生成ios设备用的未经编译的工程\n./flutter/tools/gn --ios --unoptimized\n\n//生成ios设备用的工程，不带符号表\n./flutter/tools/gn --ios\n\n//生成release工程\n ./flutter/tools/gn --ios --runtime-mode=release\n\n//生成模拟器版本工程\n./flutter/tools/gn --ios --simulator \n\n//生成模拟器用的未优化版本\n./flutter/tools/gn --ios --simulator --unoptimized  \n\n//也可以可以指定cpu\n./flutter/tools/gn --runtime-mode=release --ios --ios-cpu=arm64\n\n")])])]),a("ul",[a("li",[t._v("编译engin工程")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("//编译relase工程\nninja -C out/ios_release\n\n//编译设备用debug模式\nninja -C out/ios_debug && ninja -C out/host_debug\n\n//编译设备用debug模式,带符号\nninja -C out/ios_debug_unopt && ninja -C out/host_debug_unopt\n\n//编译模拟器用debug模式\n ninja -C out/ios_debug_sim_unopt && ninja -C out/host_debug_unopt\n\n")])])]),a("ul",[a("li",[t._v("使用编译后的工程产物")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("//方案1：在工程中使用\nflutter run --local-engine-src-path /Users/boo/Documents/engine/src --local-engine=ios_debug_unopt\n\n//方案2：换掉flutter目录里面的engine\n .../flutter/bin/cache/artifacts/engine\n")])])]),a("h4",{attrs:{id:"android编译"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#android编译"}},[t._v("#")]),t._v(" android编译")]),t._v(" "),a("ul",[a("li",[t._v("进入src目录.准备构建文件")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("./flutter/tools/gn --runtime-mode profile //生成Host编译产物存放文件\n./flutter/tools/gn --android --runtime-mode profile //生成Android编译产物存放文件\n")])])]),a("ul",[a("li",[a("p",[t._v("构建可执行文件")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("ninja -C out/host_profile -j 6\nninja -C out/android_profile -j 6\n")])])])])]),t._v(" "),a("h2",{attrs:{id:"错误"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#错误"}},[t._v("#")]),t._v(" 错误")]),t._v(" "),a("h4",{attrs:{id:"错误1"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#错误1"}},[t._v("#")]),t._v(" 错误1")]),t._v(" "),a("p",[t._v("类似问题见"),a("a",{attrs:{href:"https://github.com/flutter/flutter/issues/52387",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里"),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("ValueError: duplicate key in dictionary: src/third_party/dart/pkg/analysis_server/language_model\n//解决方案\ncd 到ios runner工程下，edit Schema 选择release模式\n")])])]),a("h4",{attrs:{id:"错误2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#错误2"}},[t._v("#")]),t._v(" 错误2")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Could not build the precompiled application for the device. Error launching\n选择puspec.yaml iosBundleIdentifier|androidPackage 设置与runner工程一致的bundle\n")])])])])}),[],!1,null,null,null);e.default=s.exports}}]);